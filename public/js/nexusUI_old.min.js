function getTemplate(e,t,i){e.canvasID=t,e.canvas=document.getElementById(t),e.context=e.canvas.getContext("2d"),e.canvas.height=window.getComputedStyle(document.getElementById(t),null).getPropertyValue("height").replace("px",""),e.canvas.width=window.getComputedStyle(document.getElementById(t),null).getPropertyValue("width").replace("px",""),e.height=parseInt(window.getComputedStyle(document.getElementById(t),null).getPropertyValue("height").replace("px","")),e.width=parseInt(window.getComputedStyle(document.getElementById(t),null).getPropertyValue("width").replace("px","")),300==e.width&&150==e.height&&(e.canvas.width=e.defaultSize.width,e.canvas.height=e.defaultSize.height,e.width=e.defaultSize.width,e.height=e.defaultSize.height),e.offset=new nx.canvasOffset(nx.findPosition(e.canvas).left,nx.findPosition(e.canvas).top),e.center={x:e.width/2,y:e.height/2},e.corners={TLx:0,TLy:0,TRx:this.width,TRy:0,BRx:this.width,BRy:this.height,BLx:0,BLy:this.height},e.lineWidth=3,e.padding=3,e.colors=new Object,e.colors.accent=nx.colors.accent,e.colors.fill=nx.colors.fill,e.colors.border=nx.colors.border,e.colors.accentborder=nx.colors.accentborder,e.colors.black=nx.colors.black,e.colors.white=nx.colors.white,e.click=new nx.point(0,0),e.clicked=!1,e.value=0,e.nodePos=new Array,e.deltaMove=new Object,e.nxThrottlePeriod=nx.nxThrottlePeriod,e.nxThrottle=nx.nxThrottle,nx.addNxObject(e),e.isRecording=!1,e.tapeNum=0,e.recorder=null,e.nxTransmit=nx.nxTransmit,e.transmissionProtocol="ajax",e.ajaxRequestType="post",e.transmitCommand=i?i:"nexusTransmit",e.oscName="/"+t,e.ajaxTransmit=nx.ajaxTransmit,e.localTransmit=function(t){nx.globalLocalTransmit(e.canvasID,e.localObject,e.localParameter,t)},e.localObject="dial1",e.localParameter="value",e.getCursorPosition=nx.getCursorPosition,e.getTouchPosition=nx.getTouchPosition,e.is_touch_device="ontouchstart"in document.documentElement?!0:!1,e.preClick=function(t){e.offset=new nx.canvasOffset(nx.findPosition(e.canvas).left,nx.findPosition(e.canvas).top),document.addEventListener("mousemove",e.preMove,!1),document.addEventListener("mouseup",e.preRelease,!1),e.clickPos=e.getCursorPosition(t,e.offset),e.clicked=!0,e.deltaMove.x=0,e.deltaMove.y=0,e.click(t)},e.preMove=function(t){e.movehandle=0;var i=e.getCursorPosition(t,e.offset);e.deltaMove.y=i.y-e.clickPos.y,e.deltaMove.x=i.x-e.clickPos.x,e.clickPos=i,e.move(t)},e.preRelease=function(){document.removeEventListener("mousemove",e.preMove,!1),e.clicked=!1,e.release(),document.removeEventListener("mouseup",e.preRelease,!1)},e.preTouch=function(t){e.clickPos=e.getTouchPosition(t,e.offset),e.clicked=!0,e.deltaMove.x=0,e.deltaMove.y=0,e.touch(t)},e.preTouchMove=function(t){if(e.clicked){var i=e.getTouchPosition(t,e.offset);e.deltaMove.y=i.y-e.clickPos.y,e.deltaMove.x=i.x-e.clickPos.x,e.clickPos=i,e.touchMove(t)}},e.preTouchRelease=function(t){e.clicked&&(e.clicked=!1),e.touchRelease(t)},e.draw=function(){},e.click=function(){},e.move=function(){},e.release=function(){},e.touch=function(){},e.touchMove=function(){},e.touchRelease=function(){},e.adjustSizeIfDefault=function(){300==e.width&&150==e.height&&(e.canvas.width=e.defaultSize.width,e.canvas.height=e.defaultSize.height,e.width=e.defaultSize.width,e.height=e.defaultSize.height)},e.makeRoundedBG=function(){this.bgLeft=this.lineWidth,this.bgRight=this.width-this.lineWidth,this.bgTop=this.lineWidth,this.bgBottom=this.height-this.lineWidth,this.bgHeight=this.bgBottom-this.lineWidth,this.bgWidth=this.bgRight-this.lineWidth,nx.makeRoundRect(e.context,e.bgLeft,e.bgTop,e.bgWidth,e.bgHeight)},e.erase=function(){e.context.clearRect(0,0,e.width,e.height)},e.hideCursor=function(){e.canvas.style.cursor="none"},e.showCursor=function(){e.canvas.style.cursor="auto"},nx.getHandlers(e)}function toggle(target,transmitCommand,uiIndex){var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:75,height:100},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.on=!1,this.fontsize=this.width>=50?20:11,this.init=function(){self.draw()},this.draw=function(){with(this.context)clearRect(0,0,this.canvas.width,canvas.height);with(this.makeRoundedBG(),this.context)strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=this.lineWidth,stroke(),fill();if(this.on)with(nx.makeRoundRect(this.context,this.bgLeft+this.padding,this.bgTop+this.padding,this.bgWidth-2*this.padding,this.bgHeight/2.1),this.context)fillStyle=self.colors.accent,strokeStyle=self.colors.border,stroke(),fill(),fillStyle=self.colors.white,font="bold "+self.fontsize+"px courier",textAlign="center",fillText("on",this.canvas.width/2,this.bgHeight/4.5+this.lineWidth+this.padding+5);else with(nx.makeRoundRect(this.context,this.bgLeft+this.padding,this.bgBottom-this.padding-this.bgHeight/2.1,this.bgWidth-2*this.padding,this.bgHeight/2.1),this.context)fillStyle=self.colors.border,strokeStyle=self.colors.border,stroke(),fill(),fillStyle=self.colors.white,font="bold "+self.fontsize+"px courier",textAlign="center",fillText("off",this.canvas.width/2,this.bgBottom-this.padding-this.bgHeight/4.5+5)},this.click=function(){self.on=self.on?!1:!0,self.draw(),self.nxTransmit(nx.boolToVal(self.on))},this.move=function(){},this.release=function(){},this.touch=function(){self.on=self.on?!1:!0,self.draw(),self.nxTransmit(nx.boolToVal(self.on))},this.touchMove=function(){},this.touchRelease=function(){},this.init()}function dial(target,transmitCommand,uiIndex){function init(){return self.circle_size=Math.min(self.center.x,self.center.y)-5,self.dial_position_length=self.circle_size+self.lineWidth,self.width<101&&(self.dial_position_length--,self.dial_position_length--),self.draw(),1}var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:100,height:100},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.circle_size=1,this.dial_position_length=6,this.lineWidth=4,this.accentWidth=this.width<101||this.width<101?1.2*this.lineWidth:2*this.lineWidth,this.value=.5,this.responsivity=.005,this.toCartesian=nx.toCartesian,this.throttle=nx.throttle,this.clip=nx.clip,this.aniStart=0,this.aniStop=1,this.aniMove=.01,this.draw=function(){var dial_angle=2*(1-self.value)*Math.PI+1.5*Math.PI,dial_position=2*(self.value+.25)*Math.PI,point=self.toCartesian(self.dial_position_length,dial_angle);with(self.isRecording&&self.recorder.write(self.tapeNum,self.value),self.context)clearRect(0,0,self.width,self.height),strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,beginPath(),arc(self.center.x,self.center.y,self.circle_size,0,2*Math.PI,!0),fill(),stroke(),closePath(),beginPath(),lineWidth=self.accentWidth,arc(self.center.x,self.center.y,self.circle_size,.5*Math.PI,dial_position,!1),lineTo(self.center.x,self.center.y),globalAlpha=.1,fillStyle=self.colors.accent,fill(),globalAlpha=1,closePath(),beginPath(),lineWidth=self.accentWidth,arc(self.center.x,self.center.y,self.circle_size,.5*Math.PI,dial_position,!1),strokeStyle=self.colors.accent,stroke(),closePath(),beginPath(),lineWidth=self.accentWidth,strokeStyle=self.colors.accent,moveTo(self.center.x,self.center.y),lineTo(point.x+self.center.x,point.y+self.center.y),stroke(),closePath(),beginPath(),fillStyle=self.colors.accent,arc(self.center.x,self.center.y,self.circle_size/15+6,0,2*Math.PI,!1),fill(),closePath()},this.click=function(){self.nxTransmit(self.value),self.draw(),self.aniStart=self.value},this.move=function(){self.value=self.clip(self.value-self.deltaMove.y*self.responsivity,0,1),self.nxTransmit(self.value),self.draw()},this.release=function(){self.aniStop=self.value},this.touch=function(){self.nxTransmit(self.value),self.draw(),self.aniStart=self.value},this.touchMove=function(){self.value=self.clip(self.value-self.deltaMove.y*self.responsivity,0,1),self.nxTransmit(self.value),self.draw()},this.touchRelease=function(){self.aniStop=self.value},this.animate=function(e){switch(e){case"bounce":nx.aniItems.push(self.aniBounce);break;case"none":nx.aniItems.splice(nx.aniItems.indexOf(self.aniBounce))}},this.aniBounce=function(){self.clicked||(self.value+=self.aniMove,self.aniStop<self.aniStart&&(self.stopPlaceholder=self.aniStop,self.aniStop=self.aniStart,self.aniStart=self.stopPlaceholder),self.aniMove=nx.bounce(self.value,self.aniStart,self.aniStop,self.aniMove),self.draw(),self.nxTransmit(self.value))},init()}function button(target,transmitCommand,uiIndex){var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:100,height:100},this.getTemplate=getTemplate,getTemplate(self,target,transmitCommand),this.value=1,this.transmitRelease=!0,this.init=function(){return self.draw(),1},this.draw=function(){with(self.context)clearRect(0,0,self.width,self.height),lineWidth=self.lineWidth,self.clicked?self.clicked&&(fillStyle=self.colors.accent,strokeStyle=self.colors.accent):(fillStyle=self.colors.fill,strokeStyle=self.colors.border),beginPath(),arc(self.center.x,self.center.y,self.center.x-6,0,2*Math.PI,!0),fill(),stroke()},this.click=function(){self.nxTransmit(self.value*nx.boolToVal(self.clicked)),self.draw()},this.move=function(){},this.release=function(){self.transmitRelease&&self.nxTransmit(self.value*nx.boolToVal(self.clicked)),self.draw()},this.touch=function(){self.nxTransmit(self.value*nx.boolToVal(self.clicked)),self.draw()},this.touchMove=function(){},this.touchRelease=function(){self.transmitRelease&&self.nxTransmit(self.value*nx.boolToVal(self.clicked)),self.draw()},this.init()}function keyboard(target,transmitCommand,uiIndex){var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:400,height:100},self.getTemplate=getTemplate,self.getTemplate(self,target,transmitCommand),self.octaves=2;var note_new,note_old,width=self.canvas.width/(12*self.octaves)/1.75,w_height=self.height,b_height=4*w_height/7,w_width=3*width,b_width=2*width,black_dis=[0,0,0,0,0,0,0,0,1,3,4,5],white_dis=[[0,2],[4,5],[7,9],[9,11],[13,14],[16,17],[19,21]],order=[0,2,4,5,7,9,11,1,3,6,8,10],keys=new Array;this.init=function(){document.addEventListener("keydown",self.type),document.addEventListener("keyup",self.untype),width=self.canvas.width/(12*self.octaves)/1.75,w_height=self.height,b_height=4*w_height/7,w_width=3*width,b_width=2*width;var e,t,i;for(t=0;t<self.octaves;t++)for(i=0;12>i;i++)if(e=order[i]+12*t,7>i){var s=w_width*(i+7*t),l=i+1,n=w_width*(l+7*t);keys.push([0,i,0,s,n,e])}else{var o=black_dis[i],a=b_width*(1+o+o/2)+7*t*w_width,h=o+1,f=b_width*(1+h+o/2)+7*t*w_width;keys.push([0,o,1,a,f,e])}return self.draw(),1},this.draw=function(){var m,i,d,xx,dis;for(m=0;m<self.octaves;m++)for(i=0;12>i;i++)if(d=12*m+i,0==keys[d][2]){var k=keys[d][1],x=k*w_width+7*m*w_width;with(self.context)lineWidth=self.lineWidth,0==keys[d][0]?(fillStyle=self.colors.fill,fillRect(x,0,w_width,w_height),strokeStyle=self.colors.border,strokeRect(x,0,w_width,w_height)):(fillStyle="#AAA",fillRect(x,0,w_width,w_height))}else with(dis=keys[d][1],xx=dis*(b_width+b_width/2)+b_width+7*m*w_width,self.context)lineWidth=self.lineWidth,fillStyle=0==keys[d][0]?self.colors.black:"#AAA",fillRect(xx,0,b_width,b_height);with(self.context)strokeStyle=self.colors.border,lineWidth=5,strokeRect(0,0,self.width,self.height)},this.change_cell=function(e,t){null!=e&&keys[e].splice(0,1,t)},this.whichKey_pressed=function(e,t){var i,s,l,n=0;if(b_height>t)for(i=0;i<self.octaves;i++){for(s=7;12>s;s++){var o=12*i+s;if(e>keys[o][3]&&e<=keys[o][4]){note_new=o,n=1;break}}if(0==n)for(l=0;7>l;l++){var a=(white_dis[l][0]+21*i)*width,h=(white_dis[l][1]+21*i)*width;if(e>a&&h>=e){var f=12*i+l;note_new=f;break}}}else if(t>b_height&&w_height>t)for(i=0;i<self.octaves;i++)for(s=0;7>s;s++){var o=12*i+s;e>keys[o][3]&&e<keys[o][4]&&(note_new=o)}else note_new=null},this.click=function(){self.whichKey_pressed(self.clickPos.x,self.clickPos.y),self.change_cell(note_new,1),note_old=note_new,midi_note=keys[note_new][5];var e=[midi_note,1];self.nxTransmit(e),self.draw()},this.move=function(){self.clicked&&(self.whichKey_pressed(self.clickPos.x,self.clickPos.y),note_old!=note_new&&(self.change_cell(note_old,0),self.change_cell(note_new,1),midi_note=keys[note_new][5],self.nxTransmit([midi_note,1]),midi_note=keys[note_old][5],self.nxTransmit([midi_note,0]),self.draw())),note_old=note_new},this.release=function(){for(j=0;j<self.octaves;j++)for(i=0;12>i;i++){var e=12*j+i;self.change_cell(e,0)}midi_note=keys[note_new][5],self.nxTransmit([midi_note,0]),self.draw()},this.touch=function(){self.whichKey_pressed(self.clickPos.x,self.clickPos.y),self.change_cell(note_new,1),note_old=note_new,midi_note=keys[note_new][5],self.nxTransmit([midi_note,1]),self.draw()},this.touchMove=function(e){self.clicked&&(self.clickPos=self.getTouchPosition(e,self.offset),self.whichKey_pressed(this.clickPos.x,this.clickPos.y),note_old!=note_new&&(self.change_cell(note_old,0),self.change_cell(note_new,1),midi_note=keys[note_new][5],self.nxTransmit([midi_note,1]),midi_note=keys[note_old][5],self.nxTransmit([midi_note,0]),self.draw())),note_old=note_new},this.touchRelease=function(){for(j=0;j<self.octaves;j++)for(i=0;12>i;i++){var e=12*j+i;self.change_cell(e,0)}midi_note=keys[note_new][5],self.nxTransmit([midi_note,0]),self.draw()},this.type=function(e){var t=e.which;if(e.which>47&&e.which<91){var i=[81,50,87,51,69,82,53,84,54,89,55,85],s=[0,7,1,8,2,3,9,4,10,5,11,6],l=i.indexOf(t);note_new=s[l],console.log(note_new),self.change_cell(note_new,1),note_old=note_new,midi_note=keys[note_new][5],self.nxTransmit(midi_note),self.draw()}},this.untype=function(e){var t=e.which;if(e.which>47&&e.which<91){var i=[81,50,87,51,69,82,53,84,54,89,55,85],s=[0,7,1,8,2,3,9,4,10,5,11,6],l=i.indexOf(t);note_old=s[l],self.change_cell(note_old,0),midi_note=keys[note_new][5],self.nxTransmit(midi_note),self.draw()}},this.init()}function position(target,transmitCommand,uiIndex){var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:300,height:200},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.nodeSize=15,this.values=[0,0],this.default_text="click or touch to control a node",this.throttle=nx.throttle,this.clip=nx.clip,this.init=function(){self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),self.context)strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill(),null!=self.nodePos[0]?self.drawNode():(fillStyle=self.colors.border,font="14px courier",fillText(self.default_text,10,20))},this.drawNode=function(){with(self.nodePos[0]<self.bgLeft+self.nodeSize?self.nodePos[0]=self.bgLeft+self.nodeSize:self.nodePos[0]>self.bgRight-self.nodeSize&&(self.nodePos[0]=self.bgRight-self.nodeSize),self.nodePos[1]<self.bgTop+self.nodeSize?self.nodePos[1]=self.bgTop+self.nodeSize:self.nodePos[1]>self.bgBottom-self.nodeSize&&(self.nodePos[1]=self.bgBottom-self.nodeSize),self.context)globalAlpha=.2,beginPath(),strokeStyle=self.colors.accent,lineWidth=2,moveTo(self.nodePos[0],0+self.padding),lineTo(self.nodePos[0],self.height-self.padding),moveTo(0+self.padding,self.nodePos[1]),lineTo(self.width-self.padding,self.nodePos[1]),stroke(),closePath(),globalAlpha=1,beginPath(),fillStyle=self.colors.accent,strokeStyle=self.colors.border,lineWidth=self.lineWidth,arc(self.nodePos[0],self.nodePos[1],self.nodeSize,0,2*Math.PI,!0),fill(),closePath()},this.scaleNode=function(){return self.values=[nx.prune(self.nodePos[0]/self.width,3),nx.prune(self.nodePos[1]/self.height,3)],self.values},this.click=function(){self.nodePos[0]=self.clickPos.x,self.nodePos[1]=self.clickPos.y,self.draw(),self.nxTransmit(self.scaleNode())},this.move=function(){self.clicked&&(self.nodePos[0]=self.clickPos.x,self.nodePos[1]=self.clickPos.y,self.draw(),{"self.clickPos.x":self.clickPos.x,"self.clickPos.y":self.clickPos.y,"self.nodePos[0]":self.nodePos[0],"self.nodePos[1]":self.nodePos[1],"self.offset":self.offset},self.nxTransmit(self.scaleNode()))},this.release=function(){},this.touch=function(){self.nodePos[0]=self.clickPos.x,self.nodePos[1]=self.clickPos.y,self.draw(),self.nxTransmit(self.scaleNode())},this.touchMove=function(){self.clicked&&(self.nodePos[0]=self.clickPos.x,self.nodePos[1]=self.clickPos.y,self.draw(),self.nxTransmit(self.scaleNode()))},this.touchRelease=function(){},this.animate=function(e){switch(e){case"bounce":nx.aniItems.push(self.aniBounce);break;case"none":nx.aniItems.splice(nx.aniItems.indexOf(self.aniBounce))}},this.aniBounce=function(){!self.clicked&&self.nodePos[0]&&(self.nodePos[0]+=self.deltaMove.x/2,self.nodePos[1]+=self.deltaMove.y/2,self.deltaMove.x=nx.bounce(self.nodePos[0],self.bgLeft+self.nodeSize,self.width-self.bgLeft-self.nodeSize,self.deltaMove.x),self.deltaMove.y=nx.bounce(self.nodePos[1],self.bgTop+self.nodeSize,self.height-self.bgTop-self.nodeSize,self.deltaMove.y),self.draw(),self.nxTransmit(self.scaleNode()))},this.init()}function matrix(target,transmitCommand,uiIndex){var self=this;this.uiIndex=uiIndex,this.defaultSize={width:200,height:200},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand);var i;this.row=3,this.col=3,this.on=!1,this.off=3,this.matrix,this.matrixLevels,this.cellHgt,this.cellWid,this.pos,this.init=function(){for(self.matrix=new Array(self.row),self.matrixLevels=new Array(self.row),i=0;i<self.matrix.length;i++)self.matrix[i]=new Array(self.col),self.matrixLevels[i]=new Array(self.col);for(i=0;i<self.row;i++)for(j=0;j<self.col;j++)self.matrix[i][j]=0,self.matrixLevels[i][j]=1;self.draw()},this.draw=function(){with(this.cellWid=(this.canvas.width-2*this.off)/this.col,this.cellHgt=(this.canvas.height-2*this.off)/this.row,this.makeRoundedBG(),this.context)strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=this.lineWidth,stroke(),fill();for(i=0;i<this.row;i++)for(j=0;j<this.col;j++){var st_x=j*this.cellWid+this.padding+this.lineWidth,st_y=i*this.cellHgt+this.padding+this.lineWidth;this.cellWid*this.matrix[i][j],this.cellHgt*this.matrix[i][j],(j+1)*this.cellWid+this.off/2,(i+1)*this.cellHgt+this.off+this.off/2;var boxwid=this.cellWid-this.padding-this.lineWidth,boxhgt=this.cellHgt-this.padding-this.lineWidth;with(nx.makeRoundRect(this.context,st_x,st_y,boxwid,boxhgt),this.context)if(strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=this.lineWidth,stroke(),fill(),this.matrix[i][j]>0){var level=Math.abs(this.matrix[i][j]-1),x1=st_x,y1=st_y+this.cellHgt*level-5*level,x2=boxwid+x1,y2=boxhgt*this.matrix[i][j]+y1,depth=6;beginPath(),this.matrix[i][j]>.95?(moveTo(x1+depth,y1),lineTo(x2-depth,y1),quadraticCurveTo(x2,y1,x2,y1+depth)):(moveTo(x1,y1),lineTo(x2,y1)),lineTo(x2,y2-depth),quadraticCurveTo(x2,y2,x2-depth,y2),lineTo(x1+depth,y2),quadraticCurveTo(x1,y2,x1,y2-depth),this.matrix[i][j]>.95?(lineTo(x1,y1+depth),quadraticCurveTo(x1,y1,x1+depth,y1)):lineTo(x1,y1),closePath(),fillStyle=self.colors.accent,fill()}}};var whichCell;this.click=function(e){for(i=0;i<self.row;i++)for(j=0;j<self.col;j++){var t=j*self.cellWid+self.off/2,s=i*self.cellHgt+self.off+self.off/2;if(t<self.clickPos.x&&self.clickPos.x<t+self.cellWid&&s<self.clickPos.y&&self.clickPos.y<s+self.cellHgt){1!=e.shiftKey&&(self.matrix[i][j]=self.matrix[i][j]>0?0:self.matrixLevels[i][j]),whichCell=[i,j];break}}self.nxTransmit(self.matrix),self.draw()},this.move=function(){self.clicked&&(delta_value=Math.min(1,Math.max(0,self.matrix[whichCell[0]][whichCell[1]]+.01*-1*self.deltaMove.y)),self.matrix[whichCell[0]][whichCell[1]]=delta_value,self.matrixLevels[whichCell[0]][whichCell[1]]=delta_value,self.nxTransmit(self.matrix),self.draw())},this.release=function(){},this.touch=function(e){for(i=0;i<self.row;i++)for(j=0;j<self.col;j++){var t=j*self.cellWid+self.off/2,s=i*self.cellHgt+self.off+self.off/2;if(t<self.clickPos.x&&self.clickPos.x<t+self.cellWid&&s<self.clickPos.y&&self.clickPos.y<s+self.cellHgt){1!=e.shiftKey&&(self.matrix[i][j]=self.matrix[i][j]>0?0:self.matrixLevels[i][j]),whichCell=[i,j];break}}self.nxTransmit(self.matrix),self.draw()},this.touchMove=function(){self.clicked&&(delta_value=Math.min(1,Math.max(0,self.matrix[whichCell[0]][whichCell[1]]+.01*-1*self.deltaMove.y)),self.matrix[whichCell[0]][whichCell[1]]=delta_value,self.matrixLevels[whichCell[0]][whichCell[1]]=delta_value,self.draw()),self.nxTransmit(self.matrix)},this.touchRelease=function(){},this.init()}function slider(target,transmitCommand,uiIndex){var self=this;this.uiIndex=uiIndex,this.defaultSize={width:30,height:200},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.value=.7,this.realSpace={x:self.width-2*self.padding,y:self.height-2*self.padding},this.sliderWidth=self.realSpace.x,this.throttle=nx.throttle,this.clip=nx.clip,this.init=function(){getHandlers(self),self.ajaxCommand||(self.ajaxCommand="slider"),self.draw()},this.draw=function(){self.erase(),self.makeRoundedBG(),self.value;var x1=self.padding,y1=self.height-self.value*self.height,x2=self.padding+self.sliderWidth,y2=self.height-self.padding,depth=2*self.padding;with(this.context)strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill(),strokeStyle=this.colors.accent,fillStyle=this.colors.border,lineWidth=5,globalAlpha=.4,beginPath(),self.value>.97?(moveTo(x1+depth,y1),lineTo(x2-depth,y1),quadraticCurveTo(x2,y1,x2,y1+depth)):(moveTo(x1,y1),lineTo(x2,y1)),lineTo(x2,y2-depth),quadraticCurveTo(x2,y2,x2-depth,y2),lineTo(x1+depth,y2),quadraticCurveTo(x1,y2,x1,y2-depth),self.value>.95?(lineTo(x1,y1+depth),quadraticCurveTo(x1,y1,x1+depth,y1)):lineTo(x1,y1),self.value>.03&&fill(),closePath(),y1-=10,y1<self.padding?y1=self.padding:y1>self.height-self.padding-20&&(y1=self.height-self.padding-20),globalAlpha=.8,beginPath(),nx.makeRoundRect(self.context,x1,y1,x2-self.padding,20),fillStyle=self.colors.black,fill(),strokeStyle=self.colors.white,lineWidth=1,closePath(),globalAlpha=1,beginPath(),strokeStyle=self.colors.border,lineWidth=3,moveTo(x1+3,y1+7),lineTo(x2-3,y1+7),moveTo(x1+3,y1+13),lineTo(x2-3,y1+13),stroke(),closePath()},this.click=function(){self.move()},this.move=function(){self.clicked&&(self.value=Math.abs(nx.clip(self.clickPos.y/self.height,.01,.98)-1),self.draw()),self.nxTransmit(self.value)},this.release=function(){},this.touch=function(){self.move()},this.touchMove=function(){self.move()},this.touchRelease=function(){}}function multislider(target,transmitCommand,uiIndex){var self=this;this.uiIndex=uiIndex,this.defaultSize={width:300,height:200},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.sliders=15,this.values=new Array;for(var i=0;i<this.sliders;i++)this.values.push(.7-i*(.3/this.sliders));this.sliderClicked=0,this.realSpace={x:self.width-2*self.padding,y:self.height-2*self.padding},this.sliderWidth=self.realSpace.x/self.sliders,this.oldSliderToMove,this.throttle=nx.throttle,this.clip=nx.clip,this.init=function(){nx.getHandlers(self),self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),this.context)for(strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill(),strokeStyle=this.colors.accent,fillStyle=this.colors.accent,lineWidth=5,i=0;i<self.sliders;i++)beginPath(),moveTo(self.padding+i*self.sliderWidth,self.height-self.values[i]*self.height),lineTo(self.padding+i*self.sliderWidth+self.sliderWidth,self.height-self.values[i]*self.height),stroke(),lineTo(self.padding+i*self.sliderWidth+self.sliderWidth,self.height-self.padding),lineTo(self.padding+i*self.sliderWidth,self.height-self.padding),globalAlpha=.3-.1*(i%3),fill(),closePath(),globalAlpha=1},this.click=function(){self.oldSliderToMove=!1,self.move()},this.move=function(){if(self.clicked){var e=Math.floor(self.clickPos.x/self.sliderWidth);if(self.values[e]=nx.clip(nx.invert(self.clickPos.y/self.height),0,1),self.oldSliderToMove){var t=e-self.oldSliderToMove;if(t>1){var s=(self.values[e]-self.values[self.oldSliderToMove])/t;for(i=1;t>i;i++)self.values[self.oldSliderToMove+i]=self.values[self.oldSliderToMove]+s*i}if(-1>t){var s=(self.values[e]-self.values[self.oldSliderToMove])/Math.abs(t);for(i=-1;i>t;i--)self.values[self.oldSliderToMove+i]=self.values[e]+s*i}}self.oldSliderToMove=e,self.draw()}self.nxTransmit(self.values)},this.release=function(){},this.touch=function(){self.oldSliderToMove=!1,self.move()},this.touchMove=function(){self.move()},this.touchRelease=function(){},this.setNumberOfSliders=function(e){this.sliders=e,this.values=new Array;for(var t=0;t<this.sliders;t++)this.values.push(.5);this.sliderWidth=self.realSpace.x/self.sliders,this.init()}}function select(e,t,i){var s=this;isNaN(i)||(s.uiIndex=i),this.defaultSize={width:200,height:30},this.getTemplate=getTemplate,this.getTemplate(s,e,t),s.choices,this.init=function(){s.canvas.ontouchstart=null,s.canvas.ontouchmove=null,s.canvas.ontouchend=null,s.choices=s.canvas.getAttribute("choices"),s.choices=s.choices.split(",");var e='<select id="'+s.canvasID+'" style="height:'+s.height+"px;width:"+s.width+"px;font-size:"+s.height/2+'px" onchange="'+s.canvasID+'.change(this)"></select><canvas height="1px" width="1px"></canvas>';$("#"+s.canvasID).replaceWith(e),s.canvas=document.getElementById(s.canvasID);for(var t=0;t<s.choices.length;t++){var i=document.createElement("option");i.text=s.choices[t],i.value=s.choices[t],s.canvas.add(i,null)}},this.change=function(e){s.value=e.value,s.nxTransmit(s.value)},this.init()}function tilt(target,transmitCommand,uiIndex){var self=this;this.uiIndex=uiIndex,this.defaultSize={width:100,height:100},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.tiltLR,this.tiltFB,this.z,this.scaledX,this.scaledY,this.scaledZ,this.defaultText="TILT",this.throttle=nx.throttle,this.clip=nx.clip,self.deviceOrientationHandler=function(){document.getElementById(self.canvasID).style.webkitTransform="rotate("+self.tiltLR+"deg) rotate3d(1,0,0, "+-1*self.tiltFB+"deg)",document.getElementById(self.canvasID).style.MozTransform="rotate("+self.tiltLR+"deg)",document.getElementById(self.canvasID).style.transform="rotate("+self.tiltLR+"deg) rotate3d(1,0,0, "+-1*self.tiltFB+"deg)",self.scaledX=nx.prune(self.tiltLR/90,3),self.scaledY=nx.prune(self.tiltFB/90,3),self.scaledZ=nx.prune(self.z,3),self.nxTransmit([self.scaledX,self.scaledY,self.scaledZ])},this.init=function(){self.draw(),window.DeviceOrientationEvent?window.addEventListener("deviceorientation",function(e){self.tiltLR=e.gamma,self.tiltFB=e.beta,self.z=e.alpha,self.deviceOrientationHandler()},!1):window.OrientationEvent?window.addEventListener("MozOrientation",function(e){self.tiltLR=90*e.x,self.tiltFB=-90*e.y,self.z=e.z,self.deviceOrientationHandler()},!1):console.log("Not supported on your device or browser.")},this.draw=function(){with(self.erase(),self.context){strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth;var grd=self.context.createRadialGradient(self.width/3,self.height/5,self.width/20,self.width/3,self.height/5,self.width);grd.addColorStop(0,self.colors.white),grd.addColorStop(1,self.colors.accent),fillStyle=grd,fillStyle=self.colors.fill,fillRect(0,0,self.width,self.height),strokeStyle=self.colors.border,lineWidth=10,strokeRect(0,0,self.width,self.height),globalAlpha=.4,fillStyle=self.colors.accent,font="bold "+self.height/5+"px gill sans",textAlign="center",fillText(self.defaultText,self.width/2,self.height/2+self.height/15),globalAlpha=1}},this.scaleNode=function(){return self.values=[nx.prune(self.nodePos[0]/self.width,3),nx.prune(self.nodePos[1]/self.height,3)],self.values},this.init()}function metroball(target,transmitCommand,uiIndex){var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:300,height:200},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.CurrentBalls=new Array,this.UISpaces=new Array;var globalMetro,ballPos=new Object,clickField=null,tempo=1,quantize=!1,tilt=0;self.tiltLR,self.tiltFB,self.z;var i;this.init=function(){self.createUISpaces(),globalMetro=setInterval(self.canvasID+".pulse()",20),window.DeviceOrientationEvent?window.addEventListener("deviceorientation",function(e){self.tiltLR=e.gamma,self.tiltFB=e.beta,self.z=e.alpha,self.tilt()},!1):window.OrientationEvent?window.addEventListener("MozOrientation",function(e){self.tiltLR=90*e.x,self.tiltFB=-90*e.y,self.z=e.z,self.tilt()},!1):console.log("Not supported on your device or browser.")},this.createUISpaces=function(){self.UISpaces=[{field:"main",xpos:5,ypos:45,wid:self.width-10,hgt:self.height-45-self.padding,hint:"click to add"},{field:"delete",xpos:45,ypos:5,wid:self.width-50,hgt:35,hint:"swipe to delete"},{field:"quantize",xpos:5,ypos:5,wid:35,hgt:35,hint:"Q"}];for(var e=0;e<self.UISpaces.length;e++)self.UISpaces[e].xpos2=self.UISpaces[e].xpos+self.UISpaces[e].wid,self.UISpaces[e].ypos2=self.UISpaces[e].ypos+self.UISpaces[e].hgt,self.UISpaces[e].centerx=self.UISpaces[e].xpos+self.UISpaces[e].wid/2,self.UISpaces[e].centery=self.UISpaces[e].ypos+self.UISpaces[e].hgt/2},this.pulse=function(){with(self.context)clearRect(0,0,self.width,self.height);self.drawSpaces(),self.drawBalls()},this.drawSpaces=function(){with(self.context){for(lineWidth=3,strokeStyle=self.colors.border,fillStyle=self.colors.fill,i=0;i<self.UISpaces.length;i++){var space=self.UISpaces[i];nx.makeRoundRect(self.context,space.xpos,space.ypos,space.wid,space.hgt),stroke(),"quantize"==space.field&&quantize?(fillStyle=self.colors.accent,fill(),fillStyle=self.colors.fill):fill()}for(lineWidth=2,fillStyle=self.colors.border,lineStyle="#ffffff",font="bold 14px courier",textAlign="center",i=0;i<self.UISpaces.length;i++){var space=self.UISpaces[i];fillText(space.hint,space.centerx,space.centery+5)}}},this.drawBalls=function(){with(self.context)for(i=0;i<self.CurrentBalls.length;i++)self.CurrentBalls[i].move(),self.CurrentBalls[i].draw()},this.click=function(){for(ballPos=self.clickPos,i=0;i<self.UISpaces.length;i++)nx.isInside(ballPos,self.UISpaces[i])&&(clickField=self.UISpaces[i].field);switch(clickField){case"main":self.addNewMB(ballPos);break;case"delete":self.deleteMB(ballPos);break;case"quantize":self.toggleQuantization()}},this.move=function(){switch(ballPos=self.clickPos,clickField){case"delete":self.deleteMB(ballPos);break;case"tempo":self.moveTempo(ballPos)}},this.release=function(){clickField=null},this.touch=function(e){self.click(e)},this.touchMove=function(e){self.move(e)},this.touchRelease=function(e){self.release(e)},this.deleteMB=function(e){for(i=self.CurrentBalls.length-1;i>=0;i--)Math.abs(self.CurrentBalls[i].xpos-e.x)<10&&self.CurrentBalls[i].kill();for(i=0;i<self.CurrentBalls.length;i++)self.CurrentBalls[i].SelfIndex=i},this.addNewMB=function(e){var t=self.CurrentBalls.length;self.CurrentBalls[t]=new self.Ball(t,e.x,e.y)},this.toggleQuantization=function(){quantize=quantize?!1:!0},this.tilt=function(){var e=nx.prune(self.tiltLR/90,3),t=nx.prune(self.tiltFB/90,3);nx.prune(self.z,3),tilt=10*e,tempo=Math.pow(t+1,3)},this.Ball=function(SelfIndex,SelfX,SelfY){this.SelfIndex=SelfIndex,this.space=self.UISpaces[0],this.color=self.colors.accent,this.xpos=SelfX,this.ypos=SelfY,this.size=10,this.direction=1,this.speed=(this.space.hgt-(this.ypos-this.space.ypos))/20,this.speedQ=5,quantize&&(this.ypos=this.space.hgt+13),this.move=function(){this.ypos=quantize?this.ypos+this.speedQ*this.direction*tempo:this.ypos+this.speed*this.direction*tempo,(this.ypos>this.space.ypos2-this.size-2||this.ypos<this.space.ypos+this.size+2)&&this.bounce(),this.ypos<this.space.ypos+this.size?this.ypos=this.space.ypos+this.size+5:this.ypos>this.space.ypos+this.space.hgt-this.size&&(this.ypos=this.space.ypos+this.space.hgt-this.size-5),this.xpos=this.xpos+tilt,this.xpos<this.space.xpos?this.xpos=this.space.xpos2:this.xpos>this.space.xpos2&&(this.xpos=this.space.xpos)},this.bounce=function(){this.direction/2+1,this.direction=-1*this.direction;var e=this.xpos/this.space.wid;self.nxTransmit([e,this.direction])},this.kill=function(){self.CurrentBalls.splice(this.SelfIndex,1)},this.draw=function(){with(self.context)beginPath(),fillStyle=this.color,1==this.direction?(this.radius=this.size*Math.abs(2*((this.ypos-this.space.ypos-this.space.hgt/2)/(this.space.hgt-this.space.ypos))),this.radius=this.radius/2+this.size/2,this.radius=this.size,this.radius=this.speed,this.radius=Math.abs(15-this.speed)):(this.radius=this.size*Math.abs(2-Math.abs(2*((this.ypos-this.space.ypos-this.space.hgt/2)/(this.space.hgt-this.space.ypos)))),this.radius=this.radius/2+this.size/2,this.radius=this.size,this.radius=Math.abs(15-this.speed)),arc(this.xpos,this.ypos,this.radius,0,2*Math.PI,!0),shadowColor=this.color,shadowBlur=2,fill(),shadowBlur=0
}},this.init()}var nxManager=function(){var manager=this;this.nxObjects=new Array,this.nxThrottlePeriod=20,this.elemTypeArr=new Array,this.aniItems=new Array,this.colorize=function(aspect,newCol){for(newCol||(newCol=aspect,aspect="accent"),i=0;i<this.nxObjects.length;i++)eval("this.nxObjects[i].colors."+aspect+" = '"+newCol+"';"),this.nxObjects[i].draw()},this.addNxObject=function(e){this.nxObjects.push(e)},this.setNxThrottlePeriod=function(e){for(manager.nxThrottlePeriod=e,i=0;i<manager.nxObjects.length;i++)manager.nxObjects[i].nxThrottlePeriod=manager.nxThrottlePeriod},this.is_touch_device="ontouchstart"in document.documentElement?!0:!1,this.canvasOffset=function(e,t){this.left=e,this.top=t},this.findPosition=function(e){var t=document.body,i=document.defaultView,s=document.documentElement,l=document.createElement("div");l.style.paddingLeft=l.style.width="1px",t.appendChild(l);var n=2==l.offsetWidth;t.removeChild(l),l=e.getBoundingClientRect();var o=s.clientTop||t.clientTop||0,a=s.clientLeft||t.clientLeft||0,h=i.pageYOffset||n&&s.scrollTop||t.scrollTop,f=i.pageXOffset||n&&s.scrollLeft||t.scrollLeft;return{top:l.top+h-o,left:l.left+f-a}},this.setTransmissionProtocol=function(e){for(i=0;i<this.nxObjects.length;i++)this.nxObjects[i].transmissionProtocol=e},this.setTransmitCommand=function(e){for(i=0;i<this.nxObjects.length;i++)this.nxObjects[i].transmitCommand=e},this.nxTransmit=function(e){e=manager.prune(e,3),"none"==this.transmissionProtocol||("ajax"==this.transmissionProtocol?this.ajaxTransmit(this.transmitCommand,this.oscName,this.uiIndex,e):"ios"==this.transmissionProtocol||"android"==this.transmissionProtocol||"local"==this.transmissionProtocol&&this.localTransmit(e))},this.globalLocalTransmit=function(){},this.ajaxTransmit=function(e,t,i,s){"post"==this.ajaxRequestType?i?$.post(e,{oscName:t,id:i,data:s}):$.post(e,{oscName:t,data:s}):"get"==this.ajaxRequestType&&(i?$.ajax(e,{oscName:t,id:i,data:s}):$.ajax(e,{oscName:t,data:s}))},this.iosTransmit=function(){},this.androidTransmit=function(){},this.getHandlers=function(e){manager.is_touch_device?(e.canvas.ontouchstart=e.preTouch,e.canvas.ontouchmove=e.nxThrottle(e.preTouchMove,e.nxThrottlePeriod),e.canvas.ontouchend=e.preTouchRelease):e.canvas.addEventListener("mousedown",e.preClick,!1)},this.point=function(e,t){this.x=e,this.y=t},this.getCursorPosition=function(e,t){var i,s;void 0!=e.pageX&&void 0!=e.pageY?(i=e.pageX,s=e.pageY):(i=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,s=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),i-=t.left,s-=t.top;var l=new nx.point(i,s);return l},this.getTouchPosition=function(e,t){var i,s;i=e.targetTouches[0].pageX,s=e.targetTouches[0].pageY,i-=t.left,s-=t.top;var l=new nx.point(i,s);return l},this.nxThrottle=function(e,t){var i;return function(){var s=this,l=arguments;i||(i=setTimeout(function(){i=null;try{e.apply(s,l)}catch(t){console.log(t)}},t))}},this.toCartesian=function(e,t){var i=Math.cos(t),s=Math.sin(t),l=new nx.point(e*i,-1*e*s);return l},this.toPolar=function(e,t){var i=Math.sqrt(e*e+t*t),s=Math.atan2(t,e);0>s&&(s+=2*Math.PI);var l=new nx.point(i,s);return l},this.clip=function(e,t,i){var s=Math.min(i,Math.max(t,e));return s},this.text=function(context,text,position){with(position||(position=[10,10]),context)beginPath(),font="bold 12px sans-serif",fillText(text,position[0],position[1]),closePath()},this.boolToVal=function(e){return e?1:0},this.prune=function(e,t){var t=Math.pow(10,t);return"number"==typeof e&&(e=Math.round(e*t)/t),e},this.scale=function(e,t,i,s,l){return outNum=(e-t)*(l-s)/(i-t)+s},this.invert=function(e){return manager.scale(e,1,0,0,1)},this.mtof=function(e){var t=440*Math.pow(2,(e-69)/12);return t},this.colors={accent:"#ff5500",fill:"#f7f7f7",border:"#ccc",accentborder:"#aa2200",black:"#000",white:"#FFF"},this.randomNum=function(e){var t=Math.floor(Math.random()*e);return t},this.randomColor=function(){var e="rgb("+this.randomNum(250)+","+this.randomNum(250)+","+this.randomNum(250)+")";return e},this.makeRoundRect=function(e,t,i,s,l){var n=t,o=i,a=s+n,h=l+o,f=6;e.beginPath(),e.moveTo(n+f,o),e.lineTo(a-f,o),e.quadraticCurveTo(a,o,a,o+f),e.lineTo(a,h-f),e.quadraticCurveTo(a,h,a-f,h),e.lineTo(n+f,h),e.quadraticCurveTo(n,h,n,h-f),e.lineTo(n,o+f),e.quadraticCurveTo(n,o,n+f,o),e.closePath()},this.isInside=function(e,t){return e.x>t.xpos&&e.x<t.xpos+t.wid&&e.y>t.ypos&&e.y<t.ypos+t.hgt?!0:!1},this.blockMove=function(e){"CANVAS"==e.target.tagName&&e.preventDefault()},this.startPulse=function(){manager.pulseInt=setInterval("nx.pulse()",30)},this.stopPulse=function(){clearInterval(manager.pulseInt)},this.pulse=function(){for(var e=0;e<manager.aniItems.length;e++)manager.aniItems[e]()},this.bounce=function(e,t,i,s){return e>t&&i>e?s:t>=e?Math.abs(s):e>=i?-1*Math.abs(s):void 0},this.addStylesheet=function(){var e="<style>select {background: transparent;-webkit-appearance: none;width: 150px;padding: 5px 5px;font-size: 16px;color:#888;border: solid 2px #CCC;border-radius: 6;outline: black;cursor:pointer;background-color:#F7F7F7;font-family:gill sans;}body {user-select: none;-moz-user-select: none;-webkit-user-select: none;cursor:pointer;}</style>";$("body").append(e)}},nx=new nxManager;nx.onload=function(){},$(document).ready(function(){var allcanvi=document.getElementsByTagName("canvas");for(i=0;i<allcanvi.length;i++){var nxId=allcanvi[i].getAttribute("nx"),elemCount=0;for(j=0;j<nx.elemTypeArr.length;j++)nx.elemTypeArr[j]==nxId&&elemCount++;if(nx.elemTypeArr.push(nxId),!allcanvi[i].id){var idNum=elemCount+1;allcanvi[i].id=nxId+idNum}nxId&&eval(allcanvi[i].id+" = new "+nxId+"('"+allcanvi[i].id+"', 'nexus', "+idNum+");")}nx.is_touch_device&&(document.addEventListener("touchmove",nx.blockMove,!0),document.addEventListener("touchstart",nx.blockMove,!0)),nx.addStylesheet(),nx.onload()});